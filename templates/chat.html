{% extends "layout.html" %}

{% block content %}
<div class="chat-wrapper">
      <div class="image-container"></div>
   <div class="friends-list">
    <h4>Danh sÃ¡ch báº¡n bÃ¨</h4>

    <!-- Ã” tÃ¬m kiáº¿m -->
    <input type="text" id="search-friend" class="form-control" placeholder="TÃ¬m kiáº¿m báº¡n bÃ¨...">

    <ul class="list-group" id="friends-container">
        {% for user in users %}
            <li class="friend-item" onclick="setReceiver({{ user.id }}, '{{ user.username }}')">
<!--                sá»­a kÃ½ tá»± \ thÃ nh / Ä‘á»ƒ hiá»‡n áº£nh-->
                <img class="avatar" src="{{ url_for('static', filename=user.avatar.replace('\\', '/')) }}" alt="Avatar">
                <span class="friend-name">{{ user.username }}</span>
                <span class="status online"></span>
            </li>
        {% endfor %}
    </ul>
</div>


    <!-- Há»™p chat -->
    <div class="chat-container hidden">
        <div class="chat-header">
            <h5 id="chat-title">Chá»n má»™t ngÆ°á»i Ä‘á»ƒ chat</h5>
        </div>
     <div id="chat-box" class="chat-box">
    {% for message in messages %}
        <div class="chat-message
            {% if message.sender_id == current_user.id|int %}sent{% else %}received{% endif %}"
            data-sender="{{ message.sender_id }}"
            data-receiver="{{ message.receiver_id }}">

            <strong>
                {% if message.sender_id == current_user.id|int %}Báº¡n{% else %}{{ message.username }}{% endif %}
            </strong>:
            {{ message.message }}
            <small class="timestamp">{{ message.sent_at }}</small>
        </div>


    {% endfor %}
</div>


        <!-- Form gá»­i tin nháº¯n -->
        <form method="POST" action="{{ url_for('chat') }}" class="chat-input">
            <input type="hidden" id="receiver_id" name="receiver_id" required>
            <input type="text" id="message" name="message" class="form-control" placeholder="Nháº­p tin nháº¯n..." required>
            <button type="submit" class="send-btn"><i class="fas fa-paper-plane"></i>Gá»­i</button>
        </form>
    </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>

<script>
    const socket = io("ws://127.0.0.1:5000");  // ğŸŸ¢ Káº¿t ná»‘i Ä‘áº¿n server
</script>

{% endblock %}
